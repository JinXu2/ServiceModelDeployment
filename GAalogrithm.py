import pandas as pd
import openpyxl
import random
import numpy as np

from Service import Service
from Application import Application
from User import User
from EdgeServer import Edge
from Node import Node
from queue import Queue
import copy
from DAG import DAG
# from Initialization import create_plan
import codecs

edge_data = pd.read_excel('数据处理/data_sheets.xlsx', sheet_name='edge_data1')

# 且不能超过其能力
capacity = edge_data['capacity'].to_list()
edge_data = pd.read_excel('数据处理/data_sheets.xlsx', sheet_name='edge_data1')
edge_list = []
for i in range(40):
    temp = edge_data.loc[i].values[0:-1]
    temp_edge = Edge(no=i + 1, latitude=temp[1], longitude=temp[2], capacity=temp[3])
    edge_list.append(temp_edge)

a0 = Application(0, [])
a1 = Application(1, ['1', '13', '14', '15', '7'])
# a1 = Application(1, ['1', '2', '3', '4'])
a2 = Application(2, ['2', '14', '16', '17', '8'])
a3 = Application(3, ['3', '14', '16', '20', '9'])
a4 = Application(4, ['4', '13', '14', '17', '10'])
a5 = Application(5, ['5', '13', '15', '18', '11'])
a6 = Application(6, ['6', '14', '16', '19', '12'])

app_list = [a0, a1, a2, a3, a4, a5, a6]

user_data = pd.read_excel('数据处理/data_sheets.xlsx', sheet_name='user_data2')
user_list = []
for i in range(len(user_data)):
    temp = user_data.loc[i].values[0:10]
    temp_user = User(i + 1, temp[1], temp[2], temp[3], temp[4:])
    user_list.append(temp_user)

service_data = pd.read_excel('数据处理/data_sheets.xlsx', sheet_name='rank_result')
rank = service_data['rank'].values

DNA_SIZE = 266
POP_SIZE = 20
CROSSOVER_RATE = 0.8
MUTATION_RATE = 0.005
N_GENERATIONS = 20

# 保存结果

import sys


# sys.stdout = open('record.txt', mode='w', encoding='utf-8')


def F(plans):
    result = []
    index = 1
    for plan in plans:
        print("正在进行个体计算", index)
        index += 1
        compute = DAG(plan=plan, service_type_sum=20, edge_list=edge_list, app_list=app_list)
        res = compute.run(user_list=user_list)
        result.append(10 / res)
        print("该方案总延迟为", res)
    # print(type(result))
    ans = np.array(result)
    return np.array(ans)


def encode(plan):
    """
    将三维plan  变成二维 编码
    :param plan: 生成的初始方案
    :return:
    """
    pop = []
    for list_i in plan:
        new = [k for a in list_i for k in a]
        pop.append(new)
    return np.array(pop)


def decode(pop):
    """
    将二维plan变成三维plan 按照capacity来分割 我的天哪这何必呢 解码
    :param pop:
    :return:
    """
    plan = []
    for list_i in pop:
        # 开始按照capacity分割
        new_list = []
        idx = 0
        for i in range(len(capacity)):
            tmp = list_i[idx:idx + capacity[i]]
            new_list.append(tmp)
            idx = idx + capacity[i]
        plan.append(new_list)
    return plan


def get_fitness(pop):  # pop 是一堆plan 所以是个三维 但是要基因操作所以得是二维的
    plan_group = decode(pop=pop)
    predict = F(plan_group)
    return predict
    # return np.array([1,2,3])

def crossover_and_mutation(pop, CROSSOVER_RATE=0.8):
    # 在这里我希望最好的方案 再往更好的情况进行变可以吗 优先变异？？

    max_fitness_index = np.argmax(fitness)
    elite = pop[max_fitness_index]
    mutation_point = np.random.randint(0, DNA_SIZE)
    elite[mutation_point] = np.random.choice(np.arange(1, 21), size=1, replace=True,
                                             p=(rank) / (rank.sum()))

    new_pop = []
    new_pop.append(elite)
    print("最优的也往好的变一下")
    for father in pop:
        child = father
        if np.random.rand() < CROSSOVER_RATE:
            mother = pop[np.random.randint(POP_SIZE)]  # 随机选一个个体作为母亲
            cross_points = np.random.randint(low=0, high=DNA_SIZE)
            child[cross_points:] = mother[cross_points:]
        mutation(child)
        new_pop.append(child)
    return new_pop


def mutation(child, MUTATION_RATE=0.005):
    if np.random.rand() < MUTATION_RATE:
        mutation_point = np.random.randint(0, DNA_SIZE)
        # 突变成什么模块
        child[mutation_point] = np.random.randint(low=0, high=20)


def select(pop, fitness):
    print("进行选择")

    # 精英保留下去
    max_fitness_index = np.argmax(fitness)
    elite = np.array(pop[max_fitness_index]).reshape(1, -1)

    # 进行交叉和变异
    pop = np.array(crossover_and_mutation(pop, CROSSOVER_RATE))
    idx = np.random.choice(np.arange(POP_SIZE), size=POP_SIZE - 1, replace=True,
                           p=(fitness) / (fitness.sum()))

    res = np.array(pop[idx])

    res = np.concatenate((res, elite), axis=0)

    # idx = np.append(idx, max_fitness_index)
    #
    # res = pop[idx]

    return res


def print_info(pop, fitness):
    max_fitness_index = np.argmax(fitness)
    print("max_fitness:", fitness[max_fitness_index])
    print("min_latency", 10 / fitness[max_fitness_index])
    print("最优的基因型：", pop[max_fitness_index])


if __name__ == '__main__':
    pop = [
        [8, 16, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 10, 12, 14, 20, 2, 17, -1, -1, -1, -1, -1,
         11, 18, -1, -1, -1, -1, 2, -1, -1, -1, -1, 4, 10, 13, 17, -1, 20, -1, -1, -1, -1, -1, -1, -1, 6, -1, -1, -1,
         -1, -1, -1, 13, -1, -1, -1, -1, -1, -1, 1, 3, 5, 6, 11, 19, -1, 6, 9, 11, 18, -1, -1, -1, -1, -1, -1, -1, -1,
         -1, 2, 8, 15, -1, -1, 3, 4, 8, 10, 12, 17, 5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 12, 15,
         -1, -1, -1, -1, 8, 13, 16, -1, -1, -1, -1, -1, 1, 4, 6, 10, 16, 17, 19, 5, 13, 18, -1, -1, 4, 8, 10, 13, 14,
         15, 14, -1, -1, -1, -1, -1, -1, -1, 9, 12, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 9, 14, 20, -1,
         -1, -1, 1, 7, 16, 18, 19, -1, -1, 2, 8, 14, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, -1,
         17, -1, -1, -1, -1, -1, -1, -1, 1, 2, 7, 19, -1, -1, 15, 16, -1, -1, -1, -1, -1, 3, 14, -1, -1, -1, -1, 5, 11,
         18, -1, -1, -1, -1, 4, 10, 14, -1, -1, -1, 7, -1, -1, -1, -1, -1, 18, -1, -1, -1, -1, 5, 13, 15, 16, -1, -1,
         -1, 2, 9, 13, 14, 16, 17, -1],
        [2, 16, 17, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 4, 10, 15, 17, 19, -1, 8, 9, 12, -1, -1, -1, -1,
         11, -1, -1, -1, -1, -1, 3, 13, 14, 16, -1, 4, 10, 13, 16, 17, 16, -1, -1, -1, -1, -1, -1, -1, 14, 16, 17, 20,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 7, 11, 18, 20, -1, -1, 6, 7, 15, -1, -1, -1, 2, 8, 13, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 2, 4, 8, 10, 14, 19, 5, 11, -1, -1, -1, -1, -1, -1, 1, 6, 11, 13, 19, -1, 5, 18, -1, -1,
         -1, -1, -1, 2, 13, 15, -1, -1, -1, -1, -1, 4, 7, 10, 13, 17, 20, -1, -1, -1, -1, -1, -1, 4, 10, 14, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, 3, 8, 9, -1, -1, -1, -1, 15, -1, -1, -1, -1, -1, -1, 3, 9, 12, 14, 16, -1, -1,
         1, 5, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 13, 18, -1, -1, -1, -1, -1, 17,
         -1, -1, -1, -1, -1, -1, -1, 1, 2, 6, 7, 9, 12, 1, 6, 14, 15, 16, 19, -1, -1, -1, -1, -1, -1, -1, 3, 5, 11, 18,
         -1, -1, -1, 4, 10, -1, -1, -1, -1, 12, -1, -1, -1, -1, -1, 5, 18, -1, -1, -1, 11, 18, -1, -1, -1, -1, -1, 8,
         14, 17, -1, -1, -1, -1],
        [8, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 4, 7, 10, 16, 19, 8, -1, -1, -1, -1, -1, -1,
         5, 11, 15, -1, -1, -1, 14, 16, 17, -1, -1, 4, 10, 13, 14, -1, 14, -1, -1, -1, -1, -1, -1, -1, 17, 20, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 12, 13, 15, 16, 18, -1, 5, 6, 13, 14, 18, 20, 2, 8, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 1, 2, 4, 10, 19, -1, 5, 18, -1, -1, -1, -1, -1, -1, 5, 11, 17, -1, -1, -1, 5, 18, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 10, 12, 17, 17, -1, 11, -1, -1, -1, -1, 2, 4, 8, 10, 13, 14,
         -1, -1, -1, -1, -1, -1, -1, -1, 7, 9, 13, 15, 16, 19, 20, -1, -1, -1, -1, -1, -1, -1, 1, 6, 7, 9, 19, 20, -1,
         3, 7, 9, 12, 14, -1, -1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 15, 16, 18, -1, -1, -1, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, 2, 3, 9, 12, 14, 15, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 11, 14, 18,
         -1, -1, -1, 4, 10, -1, -1, -1, -1, 1, 6, -1, -1, -1, -1, 11, 13, -1, -1, -1, 11, 13, -1, -1, -1, -1, -1, 2, 6,
         16, 17, -1, -1, -1],
        [16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 10, 12, 16, 17, 2, -1, -1, -1, -1, -1,
         -1, 5, 14, 18, -1, -1, -1, 2, 8, -1, -1, -1, 1, 4, 7, 10, 17, 20, -1, -1, -1, -1, -1, -1, -1, 8, 15, -1, -1,
         -1, -1, -1, 15, -1, -1, -1, -1, -1, -1, 5, 11, 13, 16, -1, -1, -1, 13, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1,
         -1, -1, 2, 8, -1, -1, -1, 2, 3, 4, 10, 12, 14, -1, -1, -1, -1, -1, -1, -1, -1, 18, 19, -1, -1, -1, -1, 11, -1,
         -1, -1, -1, -1, -1, 14, 16, -1, -1, -1, -1, -1, -1, 4, 10, 17, 19, -1, -1, -1, 5, 18, -1, -1, -1, 4, 8, 10, 13,
         14, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 6, 7, 13, 14, 20, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 7, 9, 12,
         20, 5, 6, 9, 13, 19, -1, -1, 2, 8, 13, 16, -1, -1, 16, -1, -1, -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, -1, 17,
         -1, -1, -1, -1, -1, -1, -1, 6, 9, 17, 19, 20, -1, -1, -1, -1, -1, -1, -1, -1, 16, -1, -1, -1, -1, -1, 1, 5, 7,
         11, 18, -1, -1, 4, 10, 14, 15, -1, -1, 3, 9, 12, -1, -1, -1, 5, 11, 13, 14, 18, 11, 14, 18, -1, -1, -1, -1, 2,
         8, 14, 15, 17, -1, -1],
        [-1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 1, 4, 9, 10, 12, 15, 2, 17, -1, -1, -1, -1, -1,
         5, 18, -1, -1, -1, -1, 2, -1, -1, -1, -1, 4, 10, 13, 14, 15, 14, 16, 17, 19, -1, -1, -1, -1, 2, 8, 17, -1, -1,
         -1, -1, 13, 15, -1, -1, -1, -1, -1, 5, 11, -1, -1, -1, -1, -1, 5, 20, -1, -1, -1, -1, 7, 16, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 1, 4, 6, 9, 10, 12, 18, -1, -1, -1, -1, -1, -1, -1, 3, 12, 20, -1, -1, -1, 11, 15, -1,
         -1, -1, -1, -1, 2, 13, 16, -1, -1, -1, -1, -1, 4, 10, 14, 17, 19, 20, -1, 5, 11, 13, 16, -1, 4, 8, 10, 13, 14,
         16, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 6, 7, 9, 14, 19,
         -1, 3, 13, 18, -1, -1, -1, -1, 8, 14, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 5, 18, -1, -1, -1, -1, -1,
         16, 17, -1, -1, -1, -1, -1, -1, 3, 6, 8, 16, 20, -1, 3, 12, -1, -1, -1, -1, -1, 13, -1, -1, -1, -1, -1, 5, 7,
         11, 18, -1, -1, -1, 4, 7, 10, 17, 17, -1, 6, 9, 19, -1, -1, -1, 11, -1, -1, -1, -1, 11, 18, -1, -1, -1, -1, -1,
         8, 14, 15, -1, -1, -1, -1],
        [8, 16, 17, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 7, 10, 12, 15, 12, 13, 16, -1, -1, -1, -1,
         11, -1, -1, -1, -1, -1, 2, 6, 13, -1, -1, 4, 10, 13, 15, -1, 16, -1, -1, -1, -1, -1, -1, -1, 2, 8, 13, 19, 20,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, -1, -1, -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, 15, -1, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 2, 3, 4, 7, 10, 16, 5, 18, -1, -1, -1, -1, -1, -1, 1, 3, 12, 19, 20, -1, 5, 11, 15, 18,
         -1, -1, -1, 8, 14, -1, -1, -1, -1, -1, -1, 4, 9, 10, 17, -1, -1, -1, 5, 18, -1, -1, -1, 4, 10, 14, 17, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 6, 7, 14, 16, 20, -1, -1,
         1, 5, 9, 11, 13, 18, 19, 2, 14, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 11, 13, 18, -1, -1, -1, -1, 15, 17,
         -1, -1, -1, -1, -1, -1, 1, 8, 9, 13, 16, 17, 1, 3, 12, 14, 16, 19, -1, -1, -1, -1, -1, -1, -1, 5, 6, 8, 11, 14,
         17, 18, 4, 10, 17, -1, -1, -1, 20, -1, -1, -1, -1, -1, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 14,
         -1, -1, -1, -1, -1],
        [2, 8, 17, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 4, 7, 10, 14, 15, 16, 14, 16, 17, -1, -1, -1, -1,
         11, 18, -1, -1, -1, -1, 14, 16, -1, -1, -1, 4, 10, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 12, 17, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 6, 13, 16, 20, -1, -1, 5, 6, 9, 12, 19, 20, 16, -1, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 2, 4, 10, 13, 14, -1, 18, -1, -1, -1, -1, -1, -1, -1, 1, 19, -1, -1, -1, -1, 3, 5, 11,
         15, -1, -1, -1, 8, 16, -1, -1, -1, -1, -1, -1, 4, 10, 17, 20, -1, -1, -1, 5, 18, -1, -1, -1, 4, 10, 13, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 7, 9, 13, -1, -1, -1, 15, -1, -1, -1, -1, -1, -1, 7, 9, 12, 14, -1, -1,
         -1, 1, 3, 7, 11, 13, 18, -1, 2, 8, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 5, 11, 13, 16, 18, -1, -1, 17,
         -1, -1, -1, -1, -1, -1, -1, 1, 2, 3, 6, 19, 20, 1, 14, 15, 19, -1, -1, -1, 6, -1, -1, -1, -1, -1, 5, 8, 11, 14,
         17, 18, -1, 4, 10, 17, -1, -1, -1, 12, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 13, -1, -1, -1, -1, -1, 2,
         9, -1, -1, -1, -1, -1],
        [8, 17, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 7, 10, 12, 13, 8, 14, 16, -1, -1, -1, -1,
         11, -1, -1, -1, -1, -1, 2, 14, -1, -1, -1, 4, 10, 14, 16, 17, 16, 16, -1, -1, -1, -1, -1, -1, 20, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 5, 6, 11, 13, 14, 18, 6, 9, -1, -1, -1, -1, 15, 20, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 2, 3, 4, 7, 8, 10, -1, -1, -1, -1, -1, -1, -1, -1, 15, 18, 19, -1, -1, -1, 5, 18, -1, -1,
         -1, -1, -1, 13, 14, 15, -1, -1, -1, -1, -1, 3, 4, 10, 13, -1, -1, -1, 5, 11, 13, 15, 18, 4, 10, 15, 17, -1, -1,
         16, -1, -1, -1, -1, -1, -1, -1, 1, 2, 7, 9, 12, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 7, 9, 12, 16, 20, -1, 1,
         5, 11, 12, 19, 20, -1, 2, 8, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 13, 14, -1, -1, -1, -1, -1, 17, -1,
         -1, -1, -1, -1, -1, -1, 1, 8, 9, 14, 16, 19, 14, 19, -1, -1, -1, -1, -1, 6, -1, -1, -1, -1, -1, 5, 11, 13, 18,
         -1, -1, -1, 4, 10, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 18, -1, -1, -1, 5, -1, -1, -1, -1, -1, -1, 2, 6,
         17, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 1, 4, 10, 12, -1, -1, 8, 17, -1, -1, -1, -1,
         -1, 5, 18, -1, -1, -1, -1, 13, 14, 16, -1, -1, 4, 6, 10, 16, 17, 17, -1, -1, -1, -1, -1, -1, -1, 2, 14, 17, 20,
         -1, -1, -1, 15, -1, -1, -1, -1, -1, -1, 5, 9, 11, 13, 18, -1, -1, 7, 11, 16, -1, -1, -1, 2, 16, -1, -1, -1, -1,
         -1, 8, -1, -1, -1, -1, 1, 2, 4, 8, 10, 16, 11, -1, -1, -1, -1, -1, -1, -1, 7, 17, -1, -1, -1, -1, 5, 15, 18,
         -1, -1, -1, -1, 13, 14, 17, 18, -1, -1, -1, -1, 4, 9, 10, 13, -1, -1, -1, 11, 14, 18, -1, -1, 4, 8, 10, 17, -1,
         -1, 14, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 12, 19, 20,
         -1, 9, 12, 19, 20, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 11, 13, -1, -1, -1, -1,
         2, 14, 16, -1, -1, -1, -1, -1, 2, 8, 9, 15, 16, 19, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 3, 5,
         6, 8, 11, 14, 3, 4, 10, 13, -1, -1, 12, 19, 20, -1, -1, -1, 15, -1, -1, -1, -1, 5, 18, -1, -1, -1, -1, -1, 7,
         15, -1, -1, -1, -1, -1],
        [2, 8, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 7, 9, 10, -1, -1, 7, 12, 13, 14, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, 1, 2, 8, 16, 17, 4, 6, 10, 13, -1, 16, -1, -1, -1, -1, -1, -1, -1, 17, -1, -1, -1, -1,
         -1, -1, 15, -1, -1, -1, -1, -1, -1, 1, 5, 9, 12, 18, -1, -1, 5, 15, 18, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
         2, 8, -1, -1, -1, 4, 9, 10, 19, -1, -1, 11, 18, -1, -1, -1, -1, -1, -1, 3, 11, -1, -1, -1, -1, 5, 11, 18, -1,
         -1, -1, -1, 8, 15, -1, -1, -1, -1, -1, -1, 4, 9, 10, 12, 13, 17, -1, 13, -1, -1, -1, -1, 2, 4, 10, 14, 16, -1,
         14, -1, -1, -1, -1, -1, -1, -1, 2, 6, 8, 19, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 6, 7, 14, 16, 19, 20, -1,
         3, 20, -1, -1, -1, -1, -1, 13, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 11, -1, -1, -1, -1, -1, 17,
         -1, -1, -1, -1, -1, -1, -1, 3, 8, 12, 19, 20, -1, 3, 16, -1, -1, -1, -1, -1, 1, 13, -1, -1, -1, -1, 1, 5, 6,
         11, 18, -1, -1, 4, 10, 14, 15, 17, -1, 7, 14, 20, -1, -1, -1, 5, 11, -1, -1, -1, 13, 18, -1, -1, -1, -1, -1, 2,
         14, 15, 16, 17, -1, -1],
        [17, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 1, 4, 10, 14, 15, 16, 14, 16, 20, -1, -1, -1,
         -1, 5, -1, -1, -1, -1, -1, 2, -1, -1, -1, -1, 4, 10, 13, 15, -1, 16, -1, -1, -1, -1, -1, -1, -1, 2, 8, 17, 19,
         20, -1, -1, 13, -1, -1, -1, -1, -1, -1, 5, 9, 11, -1, -1, -1, -1, 9, 13, 14, -1, -1, -1, 8, -1, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 4, 8, 10, 16, -1, -1, 11, 18, -1, -1, -1, -1, -1, -1, 11, 14, -1, -1, -1, -1, 1, 11, 15,
         18, -1, -1, -1, 13, 14, 16, 17, -1, -1, -1, -1, 4, 10, 13, -1, -1, -1, -1, 5, 18, -1, -1, -1, 2, 4, 10, 17, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 7, 8, 19, 20, 15, -1, -1, -1, -1, -1, -1, 3, 6, 7, 12, 16, 19, 20,
         1, 3, 6, 7, 12, 18, 19, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 11, 18, -1, -1, -1, -1, 17, -1,
         -1, -1, -1, -1, -1, -1, 3, 6, 7, 9, 12, 17, 13, 14, 15, 16, -1, -1, -1, 9, -1, -1, -1, -1, -1, 2, 5, 8, 11, 14,
         18, -1, 4, 10, 14, 17, -1, -1, 12, -1, -1, -1, -1, -1, 5, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
         -1, -1, -1, -1, -1],
        [2, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 7, 10, -1, -1, -1, 7, 13, 14, -1, -1, -1, -1,
         7, 11, -1, -1, -1, -1, 8, -1, -1, -1, -1, 4, 10, 15, 16, 17, 14, 16, -1, -1, -1, -1, -1, -1, 12, 13, 14, 15,
         16, 17, 20, 2, -1, -1, -1, -1, -1, -1, 1, 3, 5, 18, -1, -1, -1, 3, 5, 6, 13, 15, 16, 2, 9, 15, -1, -1, -1, -1,
         8, -1, -1, -1, -1, 4, 8, 10, 13, -1, -1, 11, -1, -1, -1, -1, -1, -1, -1, 18, -1, -1, -1, -1, -1, 5, 9, 18, -1,
         -1, -1, -1, 8, -1, -1, -1, -1, -1, -1, -1, 1, 4, 7, 10, 13, -1, -1, 5, 18, -1, -1, -1, 4, 10, 14, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 6, 12, 14, 19, 20, -1,
         -1, 1, 9, 12, 20, -1, -1, -1, 2, 14, 16, 17, -1, -1, 14, -1, -1, -1, -1, -1, -1, 11, -1, -1, -1, -1, -1, -1,
         15, 17, -1, -1, -1, -1, -1, -1, 1, 2, 3, 6, 8, 9, 14, 16, -1, -1, -1, -1, -1, 3, 13, -1, -1, -1, -1, 5, 8, 11,
         17, 18, 19, -1, 4, 10, 17, 19, -1, -1, 12, 19, 20, -1, -1, -1, 5, 11, 13, -1, -1, 11, 18, -1, -1, -1, -1, -1,
         14, -1, -1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 10, 12, 14, -1, -1, 1, 2, 8, 13, 16, 17, -1,
         5, 18, -1, -1, -1, -1, 2, 8, -1, -1, -1, 4, 6, 10, 17, 19, 16, -1, -1, -1, -1, -1, -1, -1, 8, 13, -1, -1, -1,
         -1, -1, 15, -1, -1, -1, -1, -1, -1, 5, 18, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 14, 18, -1, -1, -1, -1,
         -1, 2, -1, -1, -1, -1, 4, 8, 9, 10, 12, 16, -1, -1, -1, -1, -1, -1, -1, -1, 1, 7, 11, 18, 20, -1, 11, -1, -1,
         -1, -1, -1, -1, 2, 13, 17, -1, -1, -1, -1, -1, 4, 10, 13, -1, -1, -1, -1, 13, 15, -1, -1, -1, 4, 10, 14, 15,
         16, 17, 14, -1, -1, -1, -1, -1, -1, -1, 6, 9, 12, 19, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 3, 6, 9, 12, 14,
         16, 19, 3, 5, 7, 11, 18, 20, -1, 2, 8, 15, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 18, -1, -1, -1, -1, -1,
         8, 17, -1, -1, -1, -1, -1, -1, 1, 2, 3, 7, 9, 20, 1, 7, 16, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 6, 11,
         14, 19, -1, -1, 4, 10, 14, -1, -1, -1, 3, -1, -1, -1, -1, -1, 5, 11, -1, -1, -1, 11, 13, -1, -1, -1, -1, -1,
         13, 14, 15, 16, 17, -1, -1],
        [8, 16, 17, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 4, 10, 12, 13, 16, 19, -1, -1, -1, -1, -1, -1,
         -1, 5, 18, 19, -1, -1, -1, 14, -1, -1, -1, -1, 4, 7, 10, 13, 16, 15, 16, 19, -1, -1, -1, -1, -1, 2, 8, 14, 16,
         17, -1, -1, 13, -1, -1, -1, -1, -1, -1, 5, 11, -1, -1, -1, -1, -1, 1, 5, 6, 15, 18, -1, 2, 15, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 2, 4, 8, 10, 12, 14, 5, 11, -1, -1, -1, -1, -1, -1, 5, 11, 14, 18, -1, -1, 11, 20, -1,
         -1, -1, -1, -1, 14, 17, -1, -1, -1, -1, -1, -1, 4, 10, 13, 17, 19, -1, -1, 14, -1, -1, -1, -1, 2, 4, 8, 10, 14,
         15, -1, -1, -1, -1, -1, -1, -1, -1, 3, 6, 7, 8, 12, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 7, 9, 12, 16,
         3, 9, -1, -1, -1, -1, -1, 2, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 18, -1, -1, -1, -1, -1, 15,
         17, -1, -1, -1, -1, -1, -1, 1, 3, 6, 9, 17, -1, 14, 16, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 7, 11,
         18, 20, -1, -1, 4, 10, 20, -1, -1, -1, 1, 9, 20, -1, -1, -1, -1, -1, -1, -1, -1, 13, 18, -1, -1, -1, -1, -1,
         13, 17, -1, -1, -1, -1, -1],
        [2, 17, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 10, 17, 19, -1, -1, -1, -1, -1, -1, -1,
         -1, 1, 5, -1, -1, -1, -1, 2, 8, 13, 14, -1, 4, 10, 14, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, 13, 15, 17, 20,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 11, 13, 18, -1, -1, -1, 1, 5, 6, 7, 13, 15, 8, 15, -1, -1, -1, -1,
         -1, 2, 8, -1, -1, -1, 3, 4, 8, 10, 16, 19, 5, -1, -1, -1, -1, -1, -1, -1, 6, 7, 11, 19, -1, -1, 9, 11, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 7, 10, 17, -1, -1, -1, 11, 18, -1, -1, -1, 4, 10, 14, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 9, 13, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 12, 14, 18, 20, 20,
         -1, 9, 12, 16, -1, -1, -1, -1, 2, 13, 16, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 13, 18, -1, -1, -1, -1,
         15, 17, -1, -1, -1, -1, -1, -1, 6, 7, 8, 9, 12, 16, 6, 14, 16, 19, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 8,
         11, 14, 18, -1, -1, 4, 10, 14, 15, -1, -1, 3, 12, -1, -1, -1, -1, 11, 14, 16, -1, -1, 18, -1, -1, -1, -1, -1,
         -1, 1, 2, 17, -1, -1, -1, -1],
        [8, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 6, 9, 10, 16, 6, 14, -1, -1, -1, -1, -1,
         5, 11, -1, -1, -1, -1, 2, 14, 16, -1, -1, 4, 10, 13, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 14, 16, 17, -1,
         -1, -1, 2, -1, -1, -1, -1, -1, -1, 5, 16, -1, -1, -1, -1, -1, 5, 15, -1, -1, -1, -1, 8, 15, -1, -1, -1, -1, -1,
         8, -1, -1, -1, -1, 3, 4, 9, 10, 20, -1, 18, -1, -1, -1, -1, -1, -1, -1, 1, 6, 9, 12, 20, -1, 18, -1, -1, -1,
         -1, -1, -1, 2, 14, -1, -1, -1, -1, -1, -1, 4, 10, 16, 17, -1, -1, -1, 11, 13, -1, -1, -1, 4, 8, 10, 13, 15, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, 3, 7, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, 3, 7, 14, 19, -1, -1, -1,
         1, 5, 7, 11, 12, 18, 19, 2, 13, 15, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 13, 18, -1, -1, -1, -1, 13, 15,
         17, -1, -1, -1, -1, -1, 1, 7, 8, 12, 19, 20, 1, 6, 9, 12, 14, 20, -1, -1, -1, -1, -1, -1, -1, 2, 5, 8, 11, 17,
         18, -1, 4, 10, -1, -1, -1, -1, 14, 19, -1, -1, -1, -1, 5, 16, 18, -1, -1, 11, -1, -1, -1, -1, -1, -1, 13, 17,
         -1, -1, -1, -1, -1],
        [2, 16, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 6, 10, 13, 15, 2, 13, 14, -1, -1, -1, -1,
         11, 18, 19, -1, -1, -1, 8, -1, -1, -1, -1, 1, 4, 10, 16, -1, 14, 15, 17, 20, -1, -1, -1, -1, 2, 17, -1, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 9, 11, 12, 16, -1, -1, 9, 14, 18, -1, -1, -1, 2, 15, 19, 20, -1, -1, -1,
         2, -1, -1, -1, -1, 3, 4, 6, 7, 10, 13, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 5, 11, 18, -1, 5, 11, -1, -1, -1,
         -1, -1, 8, 17, -1, -1, -1, -1, -1, -1, 4, 7, 9, 10, 12, 14, 16, 5, 13, 15, -1, -1, 4, 10, 14, 16, 17, 19, -1,
         -1, -1, -1, -1, -1, -1, -1, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 6, 20, -1, -1, -1, -1, -1,
         12, 18, 19, -1, -1, -1, -1, 8, -1, -1, -1, -1, -1, 16, -1, -1, -1, -1, -1, -1, 5, 11, 18, -1, -1, -1, -1, 8,
         14, 15, 17, -1, -1, -1, -1, 7, 8, 12, 17, -1, -1, 1, 3, -1, -1, -1, -1, -1, 13, 20, -1, -1, -1, -1, 1, 5, 11,
         14, 18, -1, -1, 4, 10, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 13, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
         8, 9, 14, 16, 17, -1, -1],
        [2, 8, 17, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 1, 4, 10, 12, 13, 17, -1, -1, -1, -1, -1, -1, -1,
         7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 10, 14, 16, 17, 10, 16, -1, -1, -1, -1, -1, -1, 8, 14, 15, 16,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 13, 14, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
         -1, -1, 2, 8, -1, -1, -1, 4, 7, 12, 16, 19, -1, 11, -1, -1, -1, -1, -1, -1, -1, 9, 18, 20, -1, -1, -1, 3, 5,
         11, 15, 18, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 4, 7, 9, 10, 17, 20, -1, 5, 13, -1, -1, -1, 2, 4, 8, 10,
         14, 19, -1, -1, -1, -1, -1, -1, -1, -1, 3, 6, 12, 13, 19, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 6, 12, 16, 19,
         -1, -1, 1, 3, 5, 6, 9, 11, 20, 13, 14, 16, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 14, 18, -1, -1, -1, -1,
         15, 17, -1, -1, -1, -1, -1, -1, 2, 3, 6, 7, 8, 9, 14, 16, 20, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 5, 8,
         11, 15, 18, -1, 4, 10, 13, 17, -1, -1, 1, -1, -1, -1, -1, -1, 5, 15, 18, -1, -1, 5, 11, 13, 18, -1, -1, -1, 2,
         17, -1, -1, -1, -1, -1],
        [-1, -1, -1, -1, -1, -1, -1, -1, 14, -1, -1, -1, -1, -1, -1, -1, 3, 4, 10, 19, -1, -1, 2, 16, -1, -1, -1, -1,
         -1, 5, 15, 18, -1, -1, -1, 8, 16, -1, -1, -1, 4, 10, 14, 17, 20, 16, 19, -1, -1, -1, -1, -1, -1, 16, -1, -1,
         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 20, -1, -1, -1, -1, -1, -1, 6, 15, -1, -1, -1, -1, 1, 13, -1, -1,
         -1, -1, -1, 2, 8, -1, -1, -1, 3, 4, 8, 10, 15, 17, 11, -1, -1, -1, -1, -1, -1, -1, 5, 11, 13, 18, -1, -1, 11,
         19, -1, -1, -1, -1, -1, 8, 13, 14, 20, -1, -1, -1, -1, 4, 10, 17, 20, -1, -1, -1, 5, 13, 14, 18, -1, 4, 10, 14,
         15, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 6, 8, 9, 12, 15, 19, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 7, 9,
         12, 16, 1, 5, 7, 9, 11, 12, 18, 2, 14, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 13, 18, -1, -1, -1, -1,
         14, 17, -1, -1, -1, -1, -1, -1, 1, 2, 7, 8, 9, 12, 14, 16, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 5,
         11, 16, 18, -1, -1, 4, 10, 13, -1, -1, -1, 7, -1, -1, -1, -1, -1, 13, -1, -1, -1, -1, 5, -1, -1, -1, -1, -1,
         -1, 2, 6, 14, 17, -1, -1, -1],
        [2, 16, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 6, 10, 19, -1, 3, -1, -1, -1, -1, -1, -1,
         5, 11, -1, -1, -1, -1, 2, 16, -1, -1, -1, 4, 10, 13, 14, 17, 14, 16, -1, -1, -1, -1, -1, -1, 8, 17, -1, -1, -1,
         -1, -1, 13, 15, -1, -1, -1, -1, -1, 1, 5, 18, -1, -1, -1, -1, 1, 7, 12, 13, 18, -1, 2, 6, -1, -1, -1, -1, -1,
         2, 8, -1, -1, -1, 4, 6, 10, 13, 14, 19, -1, -1, -1, -1, -1, -1, -1, -1, 3, 5, 7, 11, 18, 20, 5, 12, -1, -1, -1,
         -1, -1, 14, 16, -1, -1, -1, -1, -1, -1, 1, 4, 10, 17, 17, -1, -1, 11, 18, -1, -1, -1, 4, 8, 10, 13, 14, 15, -1,
         -1, -1, -1, -1, -1, -1, -1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 6, 9, 14, 16, 19, -1, -1, 9,
         15, -1, -1, -1, -1, -1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 15, -1, -1, -1, -1, -1, 17, -1,
         -1, -1, -1, -1, -1, -1, 2, 7, 8, 9, 14, 16, 3, 7, 14, 16, 20, -1, -1, 12, 13, -1, -1, -1, -1, 2, 5, 11, 17, 18,
         20, -1, 4, 10, 20, -1, -1, -1, 19, -1, -1, -1, -1, -1, 11, 13, 14, -1, -1, 11, 18, -1, -1, -1, -1, -1, 1, 8,
         12, 15, -1, -1, -1]]

    # pop = encode(create_plan(POP_SIZE))
    # print(pop)
    pop = np.array(pop)
    generation = 1
    for _ in range(N_GENERATIONS):
        print("正在进行迭代", generation)

        generation += 1
        # 计算该种群的适应度
        fitness = get_fitness(pop)
        # # 当前最优个体 保留最优解
        # max_fitness_index = np.argmax(fitness)
        # elite = pop[max_fitness_index]
        # # elite.reshape(1, -1)
        # print(type(elite))
        print_info(pop, fitness)
        pop = np.array(select(pop, fitness))
        # pop = np.array(crossover_and_mutation(pop, CROSSOVER_RATE))
        # index = select(pop, fitness)
        # # index = np.append(index, max_fitness_index) 这时候pop都已经变了
        # pop = pop[index].tolist()
        # pop.append(elite)

    # 我感觉这样子改 更容易局部最优了。。之前在select里面是精英选择？？
